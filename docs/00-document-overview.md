# Fiskalizacija - Technical Specification Overview

**Document Title:** Fiskalizacija - Tehnička specifikacija za korisnike
**Version:** 2.6
**Date:** December 8, 2025
**Pages:** 177
**Language:** Croatian

---

## Document Statistics

- **Total Pages:** 177
- **Total Chapters:** 6
- **Code Examples:** 8 XML examples
- **Flow Diagrams:** 9
- **XML Schema Visualizations:** 15 (ignored in documentation)

---

## Table of Contents

### Chapter 1: Uvod (Introduction) - Pages 5-6
- Purpose of the document
- Target audience
- Document scope

### Chapter 2: Opis rješenja (Solution Description) - Pages 7-39
- System architecture overview
- Invoice fiscalization flow
- Payment method change flow
- Response structures
- Error handling
- Time synchronization requirements

### Chapter 3: Prijava i autentikacija (Registration and Authentication) - Pages 40-47
- FINA system registration
- Certificate-based authentication
- User management
- Security requirements

### Chapter 4: Elektronički potpis (Electronic Signature) - Pages 48-54
- Digital signature creation
- Certificate validation
- Certificate chain verification
- Signature placement in SOAP messages

### Chapter 5: Servisi (Services) - Pages 55-133

#### 5.1 Poslovni prostor (Business Space) - Pages 55-65
- Register business locations
- Update business space information
- Request/Response structures

#### 5.2 Fiskalizacija računa (Invoice Fiscalization) - Pages 66-71
- Submit invoices for fiscalization
- JIR (Unique Invoice Identifier) generation
- ZKI (Security Code) calculation
- Request/Response structures

#### 5.3 Promjena načina plaćanja (Payment Method Change) - Pages 72-81
- Update payment information for fiscalized invoices
- Request/Response structures

#### 5.4 Fiskalizacija ISSN broj (ISSN Number Fiscalization) - Pages 82-90
- Fiscalize ISSN-specific invoices
- Request/Response structures

#### 5.5 Izvješće o izdanom računu (Invoice Issuance Report) - Pages 91-114
- Generate invoice reports (PD and PO forms)
- Request/Response structures

#### 5.6 Provjera radnog vremena (Working Hours Verification) - Pages 115-133
- Report working hours for business locations
- Retrieve working hours data
- PD and PO form handling

### Chapter 6: Primjeri poruka (Message Examples) - Pages 134-177
- Complete XML message examples for all services
- SOAP envelope examples
- Error response examples

---

## Image Inventory

### Code Examples (57 XML files)

All XML examples are from the official specification (Chapter 9, pages 115-207, examples 9.1-9.57). Each example includes the complete SOAP envelope structure.

**Examples include:**
- Invoice (Racun) - fiscalization requests and responses
- Payment method change (Promjena nacina placanja) requests and responses
- Tip (Napojnica) requests and responses
- Working hours (Radno vrijeme) - get, delete, report operations
- Echo method examples
- Error response examples with CIS error codes

For detailed listing and links to all examples, see [Services Detailed Documentation](06-11-services-detailed.md#code-examples).

### Flow Diagrams (9 images)

All flow diagrams have been converted to Mermaid format in the `diagrams/` directory:

1. **Page 13** - Invoice fiscalization flow
   - File: `flow-fiskalizacija-racuna.mermaid`

2. **Page 14** - Payment method change flow
   - File: `flow-promjena-placanja.mermaid`

3. **Page 28** - Response structure with error handling
   - File: `flow-response-structure.mermaid`

4. **Page 44** - Authentication flow
   - File: `flow-authentication.mermaid`

5. **Page 50** - Signature verification flow
   - File: `flow-signature-verification.mermaid`

6. **Page 51** - Digital signature creation
   - File: `flow-signature-creation.mermaid`

7. **Page 52** - Certificate validation
   - File: `flow-certificate-validation.mermaid`

8. **Page 53** - Certificate chain validation
   - File: `flow-certificate-chain.mermaid`

9. **Page 54** - Signature placement in SOAP
   - File: `flow-signature-soap.mermaid`

### XML Schema Visualizations (15 images)
**Ignored** - These are visual representations of XML schema hierarchy and don't require conversion.

---

## Key Technical Concepts

### JIR (Jedinstveni Identifikator Računa)
- Unique Invoice Identifier
- Generated by CIS after successful invoice fiscalization
- Must be printed on every fiscalized invoice
- Format: 34-character alphanumeric string

### ZKI (Zaštitni Kod Izdavatelja)
- Security Code Issuer
- Generated locally by the taxpayer system
- Must be calculated and printed before fiscalization
- Based on: certificate + OIB + datetime + invoice number + location + device + amount
- Format: 32-character alphanumeric string

### CIS (Centralni Informacijski Sustav)
- Central Information System
- Operated by Croatian Tax Authority
- Handles all fiscalization requests
- Available at:
  - Production: `https://cis.porezna-uprava.hr:8449/FiskalizacijaService`
  - Test: `https://cistest.apis-it.hr:8449/FiskalizacijaServiceTest`

### FINA System
- Financial Agency (Financijska agencija)
- Used for initial registration
- Manages certificate issuance

---

## Namespaces

```xml
xmlns="http://www.apis-it.hr/fin/2012/types/f73"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:xsd="http://www.w3.org/2001/XMLSchema"
```

---

## Related Documentation

- **FiskalizacijaSchema.xsd** - Main XML schema definition (v1.3)
- **xmldsig-core-schema.xsd** - W3C XML digital signature schema
- **FiskalizacijaSchema.designer.cs** - Auto-generated C# classes from XSD

---

## Document Structure

```
docs/
├── technical-specification/
│   ├── 00-document-overview.md           # This file
│   ├── 01-introduction.md                # Chapter 1
│   ├── 02-solution-description.md        # Chapter 2
│   ├── 03-registration-authentication.md # Chapter 3
│   ├── 04-electronic-signature.md        # Chapter 4
│   ├── 05-services-overview.md           # Chapter 5 intro
│   ├── 06-service-business-space.md      # Service 5.1
│   ├── 07-service-invoice-fiscalization.md # Service 5.2
│   ├── 08-service-payment-change.md      # Service 5.3
│   ├── 09-service-issn-fiscalization.md  # Service 5.4
│   ├── 10-service-invoice-report.md      # Service 5.5
│   ├── 11-service-working-hours.md       # Service 5.6
│   ├── 12-message-examples.md            # Chapter 6
│   └── diagrams/                         # Mermaid flow diagrams
│       ├── flow-fiskalizacija-racuna.mermaid
│       ├── flow-promjena-placanja.mermaid
│       ├── flow-response-structure.mermaid
│       ├── flow-authentication.mermaid
│       ├── flow-signature-verification.mermaid
│       ├── flow-signature-creation.mermaid
│       ├── flow-certificate-validation.mermaid
│       ├── flow-certificate-chain.mermaid
│       └── flow-signature-soap.mermaid
└── code-examples/                        # XML code examples (57 files)
    ├── racun-*.xml                         # Invoice & invoice check examples (9.1-9.6, 9.31-9.37)
    ├── promjena-nacina-placanja-*.xml       # Payment change examples (9.7-9.14)
    ├── prodaja-samoposluzni-*.xml           # Self-service examples (9.15-9.20)
    ├── napojnica-*.xml                     # Tip/ISSN examples (9.21-9.28)
    ├── echo-metoda-*.xml                   # Echo method examples (9.29-9.30)
    ├── promjena-podataka-racuna-*.xml      # Change invoice data examples (9.38-9.41)
    ├── dohvat-radnog-vremena-*.xml         # Get working hours examples (9.42-9.45)
    ├── brisanje-radnog-vremena-*.xml       # Delete working hours examples (9.46-9.49)
    ├── prijava-radnog-vremena-*.xml        # Report working hours examples (9.50-9.53)
    └── prijava-radnih-vremena-liste-poslovnih-*.xml  # Report for list examples (9.54-9.57)
```

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 2.6 | 2025-12-08 | Current version |

---

## Document References

- **CIS (Centralni Informacijski Sustav)** - Croatian Tax Authority Central Information System
- **FINA** - Financial Agency (Financijska agencija)
- **XML Schema** - FiskalizacijaSchema v1.3
- **W3C Standards** - XML Signature (xmldsig-core-schema)

---

*This documentation was extracted from the official Croatian Government technical specification for the fiscalization system.*
